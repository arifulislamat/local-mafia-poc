<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>P2P Shooter POC</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- ===== Lobby Screen ===== -->
    <div id="lobby">
      <h1>‚öî P2P Shooter</h1>
      <p>A peer-to-peer browser battle game</p>

      <!-- Maze Selector -->
      <div id="maze-selector">
        <h3>SELECT MAP</h3>
        <div id="maze-grid"></div>
      </div>

      <div class="lobby-buttons">
        <button class="btn btn-secondary" onclick="Game.showOnlineUI('host')">
          üåê Create Online Game
        </button>
        <button class="btn btn-secondary" onclick="Game.showOnlineUI('join')">
          üîó Join Online Game
        </button>
      </div>
      <div class="lobby-buttons" style="margin-top: 0.5rem">
        <button
          class="btn btn-primary btn-small"
          onclick="Game.startLocalGame()"
        >
          ‚ñ∂ Local 2-Player (Same Keyboard)
        </button>
      </div>

      <p class="maze-rotation-note">
        Maps rotate randomly every 5 minutes during gameplay
      </p>
    </div>

    <!-- Maze selector builder script (runs after constants.js) -->
    <script>
      function buildMazeSelector() {
        const grid = document.getElementById("maze-grid");
        if (!grid) return;
        grid.innerHTML = "";
        MAZE_KEYS.forEach((key, i) => {
          const maze = MAZES[key];
          const div = document.createElement("div");
          div.className = "maze-option" + (i === 0 ? " selected" : "");
          div.dataset.maze = key;
          div.onclick = () => {
            Game.selectMaze(key);
            document
              .querySelectorAll(".maze-option")
              .forEach((el) => el.classList.remove("selected"));
            div.classList.add("selected");
          };

          // Mini preview canvas
          const preview = document.createElement("canvas");
          const pw = 105,
            ph = 75;
          preview.width = pw;
          preview.height = ph;
          const pctx = preview.getContext("2d");
          const cw = pw / maze.data[0].length;
          const ch = ph / maze.data.length;
          maze.data.forEach((row, r) => {
            row.forEach((cell, c) => {
              if (cell === 1) pctx.fillStyle = "#3a3a5c";
              else if (cell === 2) pctx.fillStyle = "#00d4ff";
              else if (cell === 3) pctx.fillStyle = "#ff4444";
              else if (cell === 4) pctx.fillStyle = "#44ff44";
              else if (cell === 5) pctx.fillStyle = "#ffaa00";
              else pctx.fillStyle = "#0a0a1a";
              pctx.fillRect(c * cw, r * ch, cw, ch);
            });
          });

          const name = document.createElement("div");
          name.className = "maze-name";
          name.textContent = maze.name;

          const desc = document.createElement("div");
          desc.className = "maze-desc";
          desc.textContent = maze.desc;

          div.appendChild(preview);
          div.appendChild(name);
          div.appendChild(desc);
          grid.appendChild(div);
        });
      }
      // Build after DOM + constants are ready
      window.addEventListener("DOMContentLoaded", () =>
        setTimeout(buildMazeSelector, 0),
      );
    </script>

    <!-- ===== Connection UI (Online Play) ===== -->
    <div id="connectionUI">
      <!-- Host Panel -->
      <div id="hostUI" style="display: none">
        <h3>CREATE ONLINE GAME</h3>
        <p class="online-subtitle">Share this room code with your opponent:</p>
        <div class="room-code" id="roomCode">------</div>
        <p id="connectionStatus">Creating room...</p>
        <button class="btn btn-secondary" onclick="Game.cancelOnline()">
          ‚úï Cancel
        </button>
      </div>

      <!-- Join Panel -->
      <div id="joinUI" style="display: none">
        <h3>JOIN ONLINE GAME</h3>
        <p class="online-subtitle">Enter the room code:</p>
        <input
          type="text"
          id="roomCodeInput"
          placeholder="ROOM CODE"
          maxlength="6"
          autocomplete="off"
          onkeydown="if (event.key === 'Enter') Game.joinOnlineGame();"
        />
        <div class="join-buttons">
          <button class="btn btn-primary" onclick="Game.joinOnlineGame()">
            Connect
          </button>
          <button class="btn btn-secondary" onclick="Game.cancelOnline()">
            ‚úï Cancel
          </button>
        </div>
        <p id="joinStatus"></p>
      </div>
    </div>

    <!-- ===== Game Canvas ===== -->
    <div id="gameContainer">
      <canvas id="gameCanvas"></canvas>
    </div>

    <!-- ===== Controls Help ===== -->
    <div id="controls-help" style="display: none">
      <span>
        <strong style="color: #00d4ff">P1:</strong>
        <span class="key">W</span><span class="key">A</span
        ><span class="key">S</span><span class="key">D</span> move ¬∑
        <span class="key">Space</span> shoot
      </span>
      <span>
        <strong style="color: #ff4444">P2:</strong>
        <span class="key">‚Üë</span><span class="key">‚Üê</span
        ><span class="key">‚Üì</span><span class="key">‚Üí</span> move ¬∑
        <span class="key">Enter</span> shoot
      </span>
      <span> <span class="key">R</span> restart </span>
    </div>

    <!-- ===== Scripts (order matters) ===== -->
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.5/dist/peerjs.min.js"></script>
    <script src="constants.js"></script>
    <script src="physics.js"></script>
    <script src="renderer.js"></script>
    <script src="network.js"></script>
    <script src="game.js"></script>
  </body>
</html>
